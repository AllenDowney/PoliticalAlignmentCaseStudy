
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Political Alignment and Outlook &#8212; Political Alignment Case Study</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Political Alignment and Other Views" href="04_worldview.html" />
    <link rel="prev" title="Political Views" href="02_polviews.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Political Alignment Case Study</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Political Alignment Case Study
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01_clean.html">
   Cleaning and Validation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_polviews.html">
   Political Views
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Political Alignment and Outlook
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_worldview.html">
   Political Alignment and Other Views
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/AllenDowney/PoliticalAlignmentCaseStudy/master?urlpath=tree/03_outlook.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>
<a href="https://github.com/AllenDowney/PoliticalAlignmentCaseStudy"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="bottom"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/03_outlook.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#are-people-fair">
   Are People Fair?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fairness-over-time">
   Fairness Over Time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#political-views-on-a-3-point-scale">
   Political Views on a 3-point Scale
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fairness-by-group">
   Fairness by Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fairness-over-time-by-group">
   Fairness over Time by Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-results">
   Plotting the Results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-possible-datasets">
   Simulating Possible Datasets
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Political Alignment and Outlook</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#loading-the-data">
   Loading the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#are-people-fair">
   Are People Fair?
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fairness-over-time">
   Fairness Over Time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#political-views-on-a-3-point-scale">
   Political Views on a 3-point Scale
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fairness-by-group">
   Fairness by Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fairness-over-time-by-group">
   Fairness over Time by Group
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-the-results">
   Plotting the Results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#simulating-possible-datasets">
   Simulating Possible Datasets
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="political-alignment-and-outlook">
<h1>Political Alignment and Outlook<a class="headerlink" href="#political-alignment-and-outlook" title="Permalink to this headline">#</a></h1>
<p>This is the third in a series of notebooks that make up a <a class="reference external" href="https://allendowney.github.io/PoliticalAlignmentCaseStudy/">case study in exploratory data analysis</a>.
This case study is part of the <a class="reference external" href="https://allendowney.github.io/ElementsOfDataScience/"><em>Elements of Data Science</em></a> curriculum.</p>
<p>In the previous chapter, we used data from the General Social Survey (GSS) to plot changes in political alignment over time.</p>
<p>In this notebook, we explore the relationship between political alignment and questions related to “outlook”, like:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">happy</span></code>: Taken all together, how would you say things are these days–would you say that you are very happy, pretty happy, or not too happy?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">trust</span></code>: Generally speaking, would you say that most people can be trusted or that you can’t be too careful in dealing with people?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">helpful</span></code>: Would you say that most of the time people try to be helpful, or that they are mostly just looking out for themselves?</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fair</span></code>: Do you think most people would try to take advantage of you if they got a chance, or would they try to be fair?</p></li>
</ul>
<p>As an example, I’ll look at <code class="docutils literal notranslate"><span class="pre">fair</span></code>, and then as an exercise you can look at one of the others.</p>
<ol class="simple">
<li><p>First we’ll use <code class="docutils literal notranslate"><span class="pre">groupby</span></code> to compare the average response between groups and plot the average as a function of time.</p></li>
<li><p>We’ll use the Pandas function <code class="docutils literal notranslate"><span class="pre">pivot</span> <span class="pre">table</span></code> to compute the average response within each group as a function of time.</p></li>
<li><p>And we’ll use resampling to see whether the features we see in the figures might be due to randomness, or whether they are likely to reflect actual changes in the works.</p></li>
</ol>
<p>If everything we need is installed, the following cell should run without error.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
</pre></div>
</div>
</div>
</div>
<p>The following cells define functions from previous notebooks we will use again.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Count the values and sort.</span>

<span class="sd">    series: pd.Series</span>

<span class="sd">    returns: series mapping from values to frequencies</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorate the current axes.</span>

<span class="sd">    Call decorate with keyword arguments like</span>
<span class="sd">    decorate(title=&#39;Title&#39;,</span>
<span class="sd">             xlabel=&#39;x&#39;,</span>
<span class="sd">             ylabel=&#39;y&#39;)</span>

<span class="sd">    The keyword arguments can be any of the axis properties</span>
<span class="sd">    https://matplotlib.org/api/axes_api.html</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>

    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">handles</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.nonparametric.smoothers_lowess</span> <span class="kn">import</span> <span class="n">lowess</span>


<span class="k">def</span> <span class="nf">make_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use LOWESS to compute a smooth line.</span>

<span class="sd">    series: pd.Series</span>

<span class="sd">    returns: pd.Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>

    <span class="n">smooth</span> <span class="o">=</span> <span class="n">lowess</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">index</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">smooth</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_series_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plots a series of data points and a smooth line.</span>

<span class="sd">    series: pd.Series</span>
<span class="sd">    color: string or tuple</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">smooth</span> <span class="o">=</span> <span class="n">make_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
    <span class="n">smooth</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_columns_lowess</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot the columns in a DataFrame.</span>

<span class="sd">    table: DataFrame with a cross tabulation</span>
<span class="sd">    columns: list of column names, in the desired order</span>
<span class="sd">    colors: mapping from column names to colors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="n">plot_series_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">colors</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="loading-the-data">
<h2>Loading the data<a class="headerlink" href="#loading-the-data" title="Permalink to this headline">#</a></h2>
<p>In the first notebook, we downloaded GSS data, loaded and cleaned it, resampled it to correct for stratified sampling, and then saved the data in an HDF5 file, which is much faster to load.  Now we’ll download the HDF5 file and load it.</p>
<p>The following cell downloads the file if necessary.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>


<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>

        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="n">local</span><span class="p">)</span>


<span class="n">download</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/AllenDowney/PoliticalAlignmentCaseStudy/raw/master/gss_eds.3.hdf&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>I’ve created an HDF file that contains three <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code> objects with resampled GSS data.  We’ll work with the first resampling, <code class="docutils literal notranslate"><span class="pre">gss0</span></code>, to get started; at the end of this chapter, we’ll see the other two as well.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datafile</span> <span class="o">=</span> <span class="s2">&quot;gss_eds.3.hdf&quot;</span>
<span class="n">gss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span> <span class="s2">&quot;gss0&quot;</span><span class="p">)</span>
<span class="n">gss</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(68846, 204)
</pre></div>
</div>
</div>
</div>
</section>
<section id="are-people-fair">
<h2>Are People Fair?<a class="headerlink" href="#are-people-fair" title="Permalink to this headline">#</a></h2>
<p>In the GSS data, the variable <code class="docutils literal notranslate"><span class="pre">fair</span></code> contains responses to this question (see <a class="reference external" href="https://gssdataexplorer.norc.org/variables/440/vshow">https://gssdataexplorer.norc.org/variables/440/vshow</a>):</p>
<blockquote>
<div><p>Do you think most people would try to take advantage of you if they got a chance, or would they try to be fair?</p>
</div></blockquote>
<p>The possible responses are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>	<span class="n">Take</span> <span class="n">advantage</span>
<span class="mi">2</span>	<span class="n">Fair</span>
<span class="mi">3</span>	<span class="n">Depends</span>
</pre></div>
</div>
<p>As always, we start by looking at the distribution of responses, that is, how many people give each response:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0    15435
2.0    22806
3.0     2755
Name: fair, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>The plurality think people try to be fair (2), but a substantial minority think people would take advantage (1).
There are also a number of NaNs, mostly respondents who were not asked this question.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>27850
</pre></div>
</div>
</div>
</div>
<p>To count the number of people who chose option 2, “people try to be fair”, I’ll use a dictionary to recode option 2 as <code class="docutils literal notranslate"><span class="pre">1</span></code> and the other options as <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recode_fair</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>As an alternative, we could include option 3, “depends”, by mapping it to 1, or give it less weight by mapping it to an intermediate value like 0.5.</p>
<p>We can use <code class="docutils literal notranslate"><span class="pre">replace</span></code> to recode the values and store the result as a new column in the DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">recode_fair</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And we’ll use <code class="docutils literal notranslate"><span class="pre">values</span></code> to check whether it worked.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair2&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0    18190
1.0    22806
Name: fair2, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="fairness-over-time">
<h2>Fairness Over Time<a class="headerlink" href="#fairness-over-time" title="Permalink to this headline">#</a></h2>
<p>As we saw in the previous notebook, we can use <code class="docutils literal notranslate"><span class="pre">groupby</span></code> to group responses by year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss_by_year</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From the result we can select <code class="docutils literal notranslate"><span class="pre">fair2</span></code> and compute the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fair_by_year</span> <span class="o">=</span> <span class="n">gss_by_year</span><span class="p">[</span><span class="s2">&quot;fair2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s the result, which shows the fraction of people who say people try to be fair, plotted over time.  As in the previous notebook, we plot the data points themselves with circles and a local regression model as a line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_series_lowess</span><span class="p">(</span><span class="n">fair_by_year</span><span class="p">,</span> <span class="s2">&quot;C1&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fraction saying yes&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Would most people try to be fair?&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/03_outlook_30_0.png" src="_images/03_outlook_30_0.png" />
</div>
</div>
<p>Sadly, it looks like faith in humanity has declined, at least by this measure.</p>
<p>Let’s see what this trend looks like if we group the respondents by political alignment.</p>
</section>
<section id="political-views-on-a-3-point-scale">
<h2>Political Views on a 3-point Scale<a class="headerlink" href="#political-views-on-a-3-point-scale" title="Permalink to this headline">#</a></h2>
<p>In the previous notebook, we looked at responses to <code class="docutils literal notranslate"><span class="pre">polviews</span></code>, which asks about political alignment.  The valid responses are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>	<span class="n">Extremely</span> <span class="n">liberal</span>
<span class="mi">2</span>	<span class="n">Liberal</span>
<span class="mi">3</span>	<span class="n">Slightly</span> <span class="n">liberal</span>
<span class="mi">4</span>	<span class="n">Moderate</span>
<span class="mi">5</span>	<span class="n">Slightly</span> <span class="n">conservative</span>
<span class="mi">6</span>	<span class="n">Conservative</span>
<span class="mi">7</span>	<span class="n">Extremely</span> <span class="n">conservative</span>
</pre></div>
</div>
<p>To make it easier to visualize groups, I’m going to lump the 7-point scale into a 3-point scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recode_polviews</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Liberal&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Liberal&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Liberal&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Conservative&quot;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;Conservative&quot;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Conservative&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>I’ll use <code class="docutils literal notranslate"><span class="pre">replace</span></code>, as we’ve seen before, and store the result as a new column in the DataFrame.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;polviews3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;polviews&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">recode_polviews</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>With this scale, there are roughly the same number of people in each group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">values</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;polviews3&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Conservative    20359
Liberal         16195
Moderate        22950
Name: polviews3, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="fairness-by-group">
<h2>Fairness by Group<a class="headerlink" href="#fairness-by-group" title="Permalink to this headline">#</a></h2>
<p>Now let’s see who thinks people are more fair, conservatives or liberals.
We’ll group the respondents by <code class="docutils literal notranslate"><span class="pre">polviews3</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">by_polviews</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;polviews3&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And compute the mean of <code class="docutils literal notranslate"><span class="pre">fair2</span></code> in each group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">by_polviews</span><span class="p">[</span><span class="s2">&quot;fair2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>polviews3
Conservative    0.582789
Liberal         0.553916
Moderate        0.542407
Name: fair2, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>It looks like conservatives are a little more optimistic, in this sense, than liberals and moderates.
But this result is averaged over the last 50 years.  Let’s see how things have changed over time.</p>
</section>
<section id="fairness-over-time-by-group">
<h2>Fairness over Time by Group<a class="headerlink" href="#fairness-over-time-by-group" title="Permalink to this headline">#</a></h2>
<p>So far, we have grouped by <code class="docutils literal notranslate"><span class="pre">polviews3</span></code> and computed the mean of <code class="docutils literal notranslate"><span class="pre">fair2</span></code> in each group.
Then we grouped by <code class="docutils literal notranslate"><span class="pre">year</span></code> and computed the mean of <code class="docutils literal notranslate"><span class="pre">fair2</span></code> for each year.
Now I want to group by <code class="docutils literal notranslate"><span class="pre">polviews3</span></code> and <code class="docutils literal notranslate"><span class="pre">year</span></code>, and compute the mean of <code class="docutils literal notranslate"><span class="pre">fair2</span></code> in each group over time.</p>
<p>We could do the computation I just described “by hand” using the tools we already have, but it is so common and useful that it has a name: it is called a <strong>pivot table</strong>, and Pandas provides a function that computes it (see <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html">https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot_table.html</a>).</p>
<p>It’s called <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code>, and it takes the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">values</span></code>, which is the name of the variable we want to summarize: <code class="docutils literal notranslate"><span class="pre">fair2</span></code> in this example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">index</span></code>, which is the name of the variable that will provide the row labels: <code class="docutils literal notranslate"><span class="pre">year</span></code> in this example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">columns</span></code>, which is the name of the variable that will provide the column labels: <code class="docutils literal notranslate"><span class="pre">polview3</span></code> in this example.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">aggfunc</span></code>, which is the function used to “aggregate”, or summarize, the values: <code class="docutils literal notranslate"><span class="pre">mean</span></code> in this example.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&quot;fair2&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;polviews3&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The result is a table that has years running down the rows and political alignment running across the columns.
Each entry in the table is the mean of <code class="docutils literal notranslate"><span class="pre">fair2</span></code> for a given group in a given year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>polviews3</th>
      <th>Conservative</th>
      <th>Liberal</th>
      <th>Moderate</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1975</th>
      <td>0.625616</td>
      <td>0.617117</td>
      <td>0.647280</td>
    </tr>
    <tr>
      <th>1976</th>
      <td>0.631696</td>
      <td>0.571782</td>
      <td>0.612100</td>
    </tr>
    <tr>
      <th>1978</th>
      <td>0.694915</td>
      <td>0.659420</td>
      <td>0.665455</td>
    </tr>
    <tr>
      <th>1980</th>
      <td>0.600000</td>
      <td>0.554945</td>
      <td>0.640264</td>
    </tr>
    <tr>
      <th>1983</th>
      <td>0.572438</td>
      <td>0.585366</td>
      <td>0.463492</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Reading across the first row, we can see that in 1975, moderates were slightly more optimistic than the other groups.</p>
<p>Reading down the first column, we can see that the estimated mean of <code class="docutils literal notranslate"><span class="pre">fair2</span></code> among conservatives varies from year to year.  It is hard to tell looking at these numbers whether it is trending up or down; we can get a better view by plotting the results.</p>
</section>
<section id="plotting-the-results">
<h2>Plotting the Results<a class="headerlink" href="#plotting-the-results" title="Permalink to this headline">#</a></h2>
<p>Before we plot the results, I’ll make a dictionary that maps from each group to a color.</p>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">muted</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;muted&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">palplot</span><span class="p">(</span><span class="n">muted</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/03_outlook_50_0.png" src="_images/03_outlook_50_0.png" />
</div>
</div>
<div class="cell tag_remove-print docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Conservative&quot;</span><span class="p">:</span> <span class="n">muted</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">:</span> <span class="n">muted</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;Liberal&quot;</span><span class="p">:</span> <span class="n">muted</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<p>We can use <code class="docutils literal notranslate"><span class="pre">plot_columns_lowess</span></code> to see the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Conservative&quot;</span><span class="p">,</span> <span class="s2">&quot;Liberal&quot;</span><span class="p">,</span> <span class="s2">&quot;Moderate&quot;</span><span class="p">]</span>
<span class="n">plot_columns_lowess</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fraction saying yes&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Would most people try to be fair?&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/03_outlook_53_0.png" src="_images/03_outlook_53_0.png" />
</div>
</div>
<p>The fraction of respondents who think people try to be fair has dropped in all three groups, although liberals and moderates might have leveled off.
In 1975, liberals were the least optimistic group.  In 2018, they might be the most optimistic.
But the responses are quite noisy, so we should not be too confident about these conclusions.</p>
<p>We can get a sense of how reliable they are by running the resampling process a few times and checking how much the results vary.</p>
</section>
<section id="simulating-possible-datasets">
<h2>Simulating Possible Datasets<a class="headerlink" href="#simulating-possible-datasets" title="Permalink to this headline">#</a></h2>
<p>The figures we have generated so far in this notebook are based on a single resampling of the GSS data.  Some of the features we see in these figures might be due to random sampling rather than actual changes in the world.</p>
<p>By generating the same figures with different resampled datasets, we can get a sense of how much variation there is due to random sampling.</p>
<p>To make that easier, the following function contains the code from the previous analysis all in one place.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_by_polviews</span><span class="p">(</span><span class="n">gss</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot mean response by polviews and year.</span>

<span class="sd">    gss: DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;polviews3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;polviews&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">recode_polviews</span><span class="p">)</span>
    <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fair&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">recode_fair</span><span class="p">)</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
        <span class="n">values</span><span class="o">=</span><span class="s2">&quot;fair2&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;polviews3&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>
    <span class="p">)</span>

    <span class="n">plot_columns_lowess</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>

    <span class="n">decorate</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fraction saying yes&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Would most people try to be fair?&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can loop through the three resampled datasets in the HDF5 file and generate a figure for each one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gss0&quot;</span><span class="p">,</span> <span class="s2">&quot;gss1&quot;</span><span class="p">,</span> <span class="s2">&quot;gss2&quot;</span><span class="p">]:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">&quot;gss_eda.3.hdf&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plot_by_polviews</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [28],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;gss0&quot;</span><span class="p">,</span> <span class="s2">&quot;gss1&quot;</span><span class="p">,</span> <span class="s2">&quot;gss2&quot;</span><span class="p">]:</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">&quot;gss_eda.3.hdf&quot;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">plot_by_polviews</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="nn">File ~/anaconda3/envs/PoliticalAlignmentCaseStudy/lib/python3.10/site-packages/pandas/io/pytables.py:427,</span> in <span class="ni">read_hdf</span><span class="nt">(path_or_buf, key, mode, errors, where, start, stop, columns, iterator, chunksize, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">424</span>     <span class="n">exists</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">    </span><span class="mi">426</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">427</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">path_or_buf</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">429</span> <span class="n">store</span> <span class="o">=</span> <span class="n">HDFStore</span><span class="p">(</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">430</span> <span class="c1"># can&#39;t auto open/close if we are using an iterator</span>
<span class="g g-Whitespace">    </span><span class="mi">431</span> <span class="c1"># so delegate to the iterator</span>

<span class="ne">FileNotFoundError</span>: File gss_eda.3.hdf does not exist
</pre></div>
</div>
</div>
</div>
<p>Features that are the same in all three figures are more likely to reflect things actually happening in the world.  Features that differ substantially between the figures are more likely to be artifacts of random sampling.</p>
<p>In this context, “artifact” has the sense of “something observed in a scientific investigation or experiment that is not naturally present but occurs as a result of the preparative or investigative procedure” (from <a class="reference external" href="https://www.lexico.com/en/definition/artifact">https://www.lexico.com/en/definition/artifact</a>).</p>
<p><strong>Exercise:</strong> As an exercise, you can run the same analysis with one of the other variables related to outlook including <code class="docutils literal notranslate"><span class="pre">happy</span></code>, <code class="docutils literal notranslate"><span class="pre">trust</span></code>, <code class="docutils literal notranslate"><span class="pre">helpful</span></code>, and maybe <code class="docutils literal notranslate"><span class="pre">fear</span></code> and <code class="docutils literal notranslate"><span class="pre">hapmar</span></code>.</p>
<p>For these variables, you will have to read the codebook to see the responses and how they are encoded, then think about which responses to report.</p>
<p>Here are the steps I suggest:</p>
<ol class="simple">
<li><p>If you have not already saved this notebook, you might want to do that first. If you are running on Colab, select “Save a copy in Drive” from the File menu.</p></li>
<li><p>Now, before you modify this notebook, make another copy and give it an appropriate name.</p></li>
<li><p>Search and replace <code class="docutils literal notranslate"><span class="pre">fair</span></code> with the name of the variable you select (use “Edit-&gt;Find and replace”).</p></li>
<li><p>Run the notebook from the beginning and see what other changes you have to make.</p></li>
</ol>
<p>Write a few sentences to describe the relationships you find between political alignment and outlook.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="02_polviews.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Political Views</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="04_worldview.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Political Alignment and Other Views</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Allen B. Downey<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>